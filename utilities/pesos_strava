#!/usr/bin/env ruby
# frozen_string_literal: true

require 'strava-ruby-client'

# ref: https://www.strava.com/settings/api

module PESOS
  class Strava

    class Error < StandardError; end

    def initialize
      # ref: https://www.markhneedham.com/blog/2020/12/15/strava-authorization-error-missing-read-permission/
      puts token
      @client = ::Strava::Api::Client.new(
        access_token: token
      )
    end

    def activities
      @client.athlete_activities
    end

    private

    def token
      ENV.fetch('STRAVA_ACCESS_TOKEN', File.read('.strava_token').strip)
    end
  end
end

strava = PESOS::Strava.new
activities = strava.activities
puts activities.first
